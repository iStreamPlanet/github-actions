# github-actions

Repository of generic reusable Github Actions

#### [`build-workspace-matrix`](build-workspace-matrix)

Builds a [workflow build matrix](https://docs.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#configuring-a-build-matrix) based on glob patterns and which files have changed in a PR/push.

#### [`helmfile-actions`](helmfile-actions)

Wraps certain [`helmfile`](https://github.com/roboll/helmfile) commands and annotates PRs with their output.

#### [`minimize-comments`](minimize-comments)

Minimizes issue/PR comments matching the given criteria. Use this in a workflow to hide the comments generated by previous runs of a job (for example, when new commits are pushed to a PR branch).

#### [`terraform-actions`](terraform-actions)

Wraps certain [`terraform`](https://www.terraform.io/docs/commands/index.html) commands and annotates PRs with their output.

#### [`update-issue`](update-issue)

Creates, updates, or closes an issue matching a given title based on other parameters.

#### [`helmfile-dependency-check`](helmfile-dependency-check)

Checks if there is a valid `helmfile.yaml` in the working directory. Executes `helmfile deps` and checks if there are any chart upgrades available.

#### [`trufflehog-actions-scan`](trufflehog-actions-scan)

Runs Trufflehog as a GitHub Action.  Based off of [`https://github.com/edplato/trufflehog-actions-scan`](https://github.com/edplato/trufflehog-actions-scan).  Uses Dependabot to stay up-to-date with the latest version.

#### [`fail-alert`](./github/workflows/fail-alert.yml)

Reusable workflow, not an action. For when you want a slack alert to notify the person who triggeredthe build when it fails 

1. Add a job that you want to monitor.
2. Add a new job directly after that.
3. It must `needs` the job you want to monitor.
4. set `if: ${{ failure() }}` on the new job.
5. Make the new job `uses: iStreamPlanet/github-actions/.github/workflows/fail-alert.yml@main`
6. fail-alert has no inputs, but does require a secrets.slack_webhook for whichever slack channel you want to message. 

Here's an example workflow 

```
name: Project X

on:
  push 

jobs:
  build:
    runs-on: ubuntu-latest
    steps
    - name: Something Fails!
      run: |
        exit 1

  notify:
    needs: build
    if: ${{ failure() }}
    uses: iStreamPlanet/github-actions/.github/workflows/fail-alert.yml@main
    secrets:
      slack_webhook: ${{ secrets.DEPLOYMENTS_SLACK_WEBHOOK }}
```                                                                  

